# 監視ログ - パラメーターシート

**作成日**: 2025-10-25
**バージョン**: 1.3
**ステータス**: ユーザー承認完了、実装開始

---

## 概要

このドキュメントは、CloudWatch監視・アラート、ログ保管に関するCloudFormation実装時に参照する設定値を環境別にまとめたものです。

---

## 6. 監視・ログパラメーター

### 6.1 CloudWatch Alarms 閾値（prod環境）

| メトリクス | 閾値 | 評価期間 | 通知先 |
|-----------|------|---------|--------|
| ECS CPU使用率 | 80%以上 | 2分間連続 | SNS Topic |
| ECS メモリ使用率 | 80%以上 | 2分間連続 | SNS Topic |
| RDS CPU使用率 | 80%以上 | 5分間連続 | SNS Topic |
| RDS フリーストレージ容量 | 10GB以下 | 1回 | SNS Topic |
| RDS 接続数 | 160以上（最大200の80%） | 1回 | SNS Topic |
| ALB TargetResponseTime | 95%ile > 1秒 | 2分間連続 | SNS Topic |
| ALB HTTPCode_Target_5XX | 5%以上 | 2分間連続 | SNS Topic |

### 6.2 ログ保管期間

| ログ種別 | CloudWatch保持期間 | S3保持期間 | S3ライフサイクル |
|---------|-------------------|-----------|----------------|
| ECS アプリケーションログ | 3ヶ月 | 2年 | 3ヶ月～1年: Standard<br/>1年～2年: Glacier |
| RDS PostgreSQLログ | 3ヶ月 | 2年 | 同上 |
| ALB アクセスログ | - | 2年 | 同上 |
| VPCフローログ | 1ヶ月 | 1年 | - |
| CloudTrail | - | 2年 | 同上 |

### 6.3 SNS Topic 設定

| Topic 名 | 用途 | サブスクリプション | 備考 |
|---------|------|---------------|------|
| facilities-prod-alerts | 本番環境アラート | Email（運用チーム） | 重要度: 高 |
| facilities-stg-alerts | ステージング環境アラート | Email（開発チーム） | 重要度: 中 |
| facilities-dev-alerts | 開発環境アラート | Email（開発チーム） | 重要度: 低 |

### 6.4 CloudWatch Container Insights

| 環境 | 有効化 | 保持期間 | 備考 |
|------|-------|---------|------|
| dev | 有効 | 3日 | コスト削減 |
| stg | 有効 | 7日 | 検証用 |
| prod | 有効 | 30日 | 本番運用 |

---

## 0.8 組織レベル監査・セキュリティサービス（Shared Account）

| サービス | 設定 | 保存先 | 備考 |
|---------|------|--------|------|
| **CloudTrail（組織）** | 有効 | s3://facilities-shared-logs/cloudtrail/ | 組織全体のAPI呼び出し記録 |
| **Config（組織）** | 有効 | s3://facilities-shared-logs/config/ | リソース設定変更記録 |
| **GuardDuty（組織）** | 有効 | SNS: facilities-shared-security-alerts | 脅威検知 |
| **Security Hub（組織）** | 有効 | SNS: facilities-shared-security-alerts | セキュリティ統合 |

---

**作成者**: SRE（PM 委譲タスク）
**最終更新**: 2025-10-25
