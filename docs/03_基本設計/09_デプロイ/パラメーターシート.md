# デプロイ - パラメーターシート

**作成日**: 2025-10-25
**バージョン**: 1.3
**ステータス**: ユーザー承認完了、実装開始

---

## 概要

このドキュメントは、デプロイ方式、CI/CD、環境変数に関するパラメーターをまとめたものです。

---

## デプロイ方式

### CloudFormation Change Set 方式

| パラメーター | 設定値 | 備考 |
|------------|--------|------|
| デプロイ方式 | Change Set（dry-run必須） | 直接デプロイ禁止 |
| スタック名規則 | {project}-{env}-{layer} | 例: facilities-prod-network |
| 承認フロー | PM承認 → 実行 | 本番環境は必須 |

### CI/CD パイプライン（将来実装）

**現在**: 手動デプロイ（Change Set スクリプト）
**将来**: GitHub Actions による自動化

| 環境 | トリガー | 承認 | デプロイ先 |
|------|---------|------|----------|
| dev | main ブランチへのpush | 不要 | 自動デプロイ |
| stg | タグ作成（v*-stg） | 不要 | 自動デプロイ |
| prod | タグ作成（v*-prod） | PM承認 | 手動承認後デプロイ |

---

## 環境変数（ECS Task Definition）

### 共通環境変数

| 環境変数名 | 設定値 | 備考 |
|----------|--------|------|
| NODE_ENV | development / staging / production | 環境識別 |
| LOG_LEVEL | debug / info / warn / error | 環境ごとに設定 |
| TZ | Asia/Tokyo | タイムゾーン |

### Secrets Manager 参照（prod環境）

| 環境変数名 | Secrets Manager ARN | 備考 |
|----------|-------------------|------|
| DB_HOST | facilities/prod/db-credentials:host | RDSエンドポイント |
| DB_PORT | facilities/prod/db-credentials:port | 5432 |
| DB_NAME | facilities/prod/db-credentials:dbname | facilities |
| DB_USER | facilities/prod/db-credentials:username | admin |
| DB_PASSWORD | facilities/prod/db-credentials:password | 暗号化 |

---

## デプロイスクリプト

### Change Set スクリプト一覧

| スクリプト名 | 用途 | 備考 |
|------------|------|------|
| create-changeset.sh | Change Set 作成（dry-run） | 変更内容のプレビュー |
| describe-changeset.sh | Change Set 内容確認 | 詳細な変更差分 |
| execute-changeset.sh | Change Set 実行 | 本番適用 |
| rollback.sh | スタックロールバック | 障害時の復旧 |

**スクリプト配置先**: `scripts/cloudformation/`

---

**作成者**: SRE（PM 委譲タスク）
**最終更新**: 2025-10-25
