# コスト試算

**作成日**: 2025-10-25
**バージョン**: 1.3
**ステータス**: ユーザー承認完了、実装開始

---

## 概要

本プロジェクトのAWSインフラにかかる月額コストを試算します。
マルチアカウント構成（Shared Account + Service Account）で構成されています。

---

## 10. コスト試算（月額）

### 10.1 Shared Account コスト（月額）

| 項目 | 単価 | 数量 | 月額（円） | 備考 |
|------|------|------|----------|------|
| **Client VPN Endpoint** | $0.10/時間 | 1エンドポイント × 24h × 30日 | 約10,800円 | 接続料 |
| **Client VPN 接続料** | $0.05/時間 | 100接続 × 8h × 22日 | 約126,000円 | 稼働時間のみ（月～土 9:00-22:00） |
| **Transit Gateway** | $0.07/時間 | 1 TGW × 24h × 30日 | 約7,500円 | TGW 本体 |
| **Transit Gateway データ処理** | $0.02/GB | 100GB | 約300円 | VPC間・VPN間通信 |
| **CloudTrail/Config/GuardDuty** | - | - | 約5,000円 | 組織レベル監査 |
| **S3（ログ保管）** | $0.025/GB | 50GB | 約180円 | 監査ログ |
| **Shared Account 合計** | | | **約149,780円/月** | |

### 10.2 Service Account コスト（月額）

#### dev環境（約30,000円/月）

| 項目 | 単価 | 数量 | 月額（円） | 備考 |
|------|------|------|----------|------|
| ECS Fargate | $0.04048/vCPU/時間 | 0.25 vCPU × 2タスク × 24h × 30日 | 約4,400円 | staff-api + vendor-api |
| ECS Fargate（メモリ） | $0.004445/GB/時間 | 0.5 GB × 2タスク × 24h × 30日 | 約960円 | |
| RDS db.t4g.micro | $0.017/時間 | 24h × 30日 | 約1,840円 | シングルAZ |
| RDS ストレージ（gp3） | $0.138/GB/月 | 20GB | 約400円 | |
| NAT Gateway | $0.062/時間 | 1 × 24h × 30日 | 約6,700円 | シングルAZ |
| NAT Gateway データ処理 | $0.062/GB | 50GB | 約440円 | |
| ALB | $0.0243/時間 | 1 × 24h × 30日 | 約2,600円 | |
| CloudWatch Logs | $0.76/GB | 10GB | 約1,090円 | |
| **dev環境 合計** | | | **約30,000円/月** | |

#### stg環境（約50,000円/月）

| 項目 | 単価 | 数量 | 月額（円） | 備考 |
|------|------|------|----------|------|
| ECS Fargate | $0.04048/vCPU/時間 | 0.25 vCPU × 4タスク × 24h × 30日 | 約8,800円 | マルチAZ（2タスク×2種） |
| ECS Fargate（メモリ） | $0.004445/GB/時間 | 0.5 GB × 4タスク × 24h × 30日 | 約1,920円 | |
| RDS db.t4g.small | $0.034/時間 | 24h × 30日 | 約3,680円 | マルチAZ |
| RDS ストレージ（gp3） | $0.138/GB/月 | 50GB × 2（マルチAZ） | 約2,000円 | |
| NAT Gateway | $0.062/時間 | 2 × 24h × 30日 | 約13,400円 | マルチAZ |
| NAT Gateway データ処理 | $0.062/GB | 100GB | 約880円 | |
| ALB | $0.0243/時間 | 1 × 24h × 30日 | 約2,600円 | |
| CloudWatch Logs | $0.76/GB | 20GB | 約2,180円 | |
| **stg環境 合計** | | | **約50,000円/月** | |

#### prod環境（約83,680円/月）

| 項目 | 単価 | 数量 | 月額（円） | 備考 |
|------|------|------|----------|------|
| ECS Fargate | $0.04048/vCPU/時間 | 0.5 vCPU × 4タスク × 24h × 30日 | 約17,600円 | マルチAZ、オートスケーリング前提（平均4タスク） |
| ECS Fargate（メモリ） | $0.004445/GB/時間 | 1 GB × 4タスク × 24h × 30日 | 約3,840円 | |
| RDS db.t4g.medium | $0.068/時間 | 24h × 30日 | 約7,360円 | マルチAZ |
| RDS ストレージ（gp3） | $0.138/GB/月 | 100GB × 2（マルチAZ） | 約4,000円 | |
| NAT Gateway | $0.062/時間 | 2 × 24h × 30日 | 約13,400円 | マルチAZ |
| NAT Gateway データ処理 | $0.062/GB | 200GB | 約1,760円 | |
| ALB | $0.0243/時間 | 2 × 24h × 30日 | 約5,200円 | staff-alb + vendor-alb |
| Cognito | $0.0055/MAU | 1,000 MAU | 約790円 | 月間アクティブユーザー |
| Secrets Manager | $0.40/シークレット/月 | 3 | 約170円 | DB接続情報等 |
| CloudWatch Logs | $0.76/GB | 50GB | 約5,450円 | |
| CloudWatch Alarms | $0.10/アラーム/月 | 20 | 約290円 | |
| **prod環境 合計** | | | **約83,680円/月** | |

### 10.3 全アカウント合計

| アカウント | 月額（円） |
|----------|----------|
| Shared Account | 約149,780円 |
| Service Account（dev） | 約30,000円 |
| Service Account（stg） | 約50,000円 |
| Service Account（prod） | 約83,680円 |
| **合計** | **約313,460円/月** |

---

## コスト最適化の余地

### 現在のコスト構成（月額31.3万円）

**最大コスト要因**:
1. **Client VPN 接続料**: 約12.6万円（40%） - 100接続 × 稼働時間
2. **NAT Gateway**: 約3.4万円（11%） - マルチAZ構成

### 最適化オプション

| 最適化案 | 削減額（月額） | 実現方法 |
|---------|-------------|---------|
| Client VPN → Direct Connect 移行 | -約12.6万円 | BGP ASN確定後、Direct Connect（100Mbps）へ移行 |
| VPC Endpoint 導入（prod） | -約500～1,000円 | NAT Gateway 通信削減（S3、ECR、Secrets Manager） |
| dev環境の夜間停止 | -約1.5万円 | ECS/RDS の夜間・週末停止（稼働時間50%削減） |

**Direct Connect 移行後の試算**:
- Client VPN削減: -約12.6万円
- Direct Connect追加: +約3万円（100Mbps専用線 + データ転送料）
- **差分**: 約9.6万円削減 → **月額21.7万円**

---

## 予算との比較

| 項目 | 金額 |
|------|------|
| RFP予算（月額） | 100万円 |
| 現在の試算（月額） | 31.3万円 |
| **予算余裕** | **68.7万円（68.7%の余裕）** |

**結論**:
予算に対して十分な余裕があり、将来的なスケールアウト、機能拡張、Direct Connect移行にも対応可能です。

---

**作成者**: SRE（PM 委譲タスク、architect 監修）
**最終更新**: 2025-10-25
