# データベース - パラメーターシート

**作成日**: 2025-10-25
**バージョン**: 1.3
**ステータス**: ユーザー承認完了、実装開始

---

## 概要

このドキュメントは、RDS PostgreSQLに関するCloudFormation実装時に参照する設定値を環境別にまとめたものです。

---

## 3. RDS PostgreSQLパラメーター

### 3.1 RDS インスタンス

| 環境 | インスタンス識別子 | インスタンスタイプ | vCPU | メモリ | ストレージ | マルチAZ |
|------|------------------|------------------|------|--------|----------|---------|
| dev | facilities-dev-db | db.t4g.micro | 2 | 1GB | 20GB (gp3) | 無効 |
| stg | facilities-stg-db | db.t4g.small | 2 | 2GB | 50GB (gp3) | 有効 |
| prod | facilities-prod-db | db.t4g.medium | 2 | 4GB | 100GB (gp3) | 有効 |

### 3.2 RDS データベース設定

| パラメーター | 設定値 | 備考 |
|------------|--------|------|
| エンジン | PostgreSQL | |
| エンジンバージョン | 14.11 | 安定版 |
| データベース名 | facilities | |
| マスターユーザー名 | admin | Secrets Managerで管理 |
| ポート | 5432 | PostgreSQLデフォルト |

### 3.3 RDS バックアップ設定

| 環境 | バックアップ保持期間 | PITR保持期間 | バックアップウィンドウ（UTC） | バックアップウィンドウ（JST） |
|------|------------------|------------|------------------------|------------------------|
| dev | 7日 | 7日 | 17:00-18:00 | 02:00-03:00 |
| stg | 7日 | 7日 | 17:00-18:00 | 02:00-03:00 |
| prod | 7日 | 35日（最長） | 17:00-18:00 | 02:00-03:00 |

### 3.4 RDS メンテナンス設定

| 環境 | メンテナンスウィンドウ（UTC） | メンテナンスウィンドウ（JST） | 自動マイナーバージョンアップ |
|------|------------------------|------------------------|----------------------|
| dev | 日 17:00-18:00 | 日 02:00-03:00 | 有効 |
| stg | 日 17:00-18:00 | 日 02:00-03:00 | 有効 |
| prod | 日 17:00-18:00 | 日 02:00-03:00 | 有効 |

### 3.5 RDS パラメータグループ（カスタム）

| パラメーター | デフォルト値 | 推奨値 | 備考 |
|------------|------------|--------|------|
| max_connections | LEAST({DBInstanceClassMemory/9531392},5000) | 200 | 接続プーリング使用前提 |
| shared_buffers | {DBInstanceClassMemory/32768} | {DBInstanceClassMemory/16384} | キャッシュサイズ増加 |
| effective_cache_size | {DBInstanceClassMemory/16384} | {DBInstanceClassMemory*3/4} | クエリプランナーヒント |
| work_mem | 4MB | 16MB | ソート・ハッシュ処理 |
| maintenance_work_mem | GREATEST({DBInstanceClassMemory/63963136},65536) | 256MB | VACUUM、CREATE INDEX |
| log_statement | none | all | すべてのSQL文をログ出力 |
| log_min_duration_statement | -1 | 1000 | 1秒以上のスロークエリ |

---

**作成者**: SRE（PM 委譲タスク）
**最終更新**: 2025-10-25
